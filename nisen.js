function convert(){
    //入力文字列
    let input = document.getElementById("i8086").value;
    //tokens 点字トークンの文字列を要素とする配列
    let tokens = Array.prototype.concat.apply([],tokenize(input).map(braillize));
    //出力先
    let output = document.getElementById("o157");
    output.value = "";
    tokens.map(amidaize).forEach(function(e){
	output.value += e + "、";
    });
}

function braillize(chs){
    //カタカナ文字（列）を点字に変換
    //左上から下に123右上から下に456
    let tenji_table = {
	"ア":["1"],
	"イ":["12"],
	"ウ":["14"],
	"エ":["124"],
	"オ":["24"],
	"カ":["16"],
	"キ":["126"],
	"ク":["146"],
	"ケ":["1246"],
	"コ":["246"],
	"サ":["156"],
	"シ":["1256"],
	"ス":["1456"],
	"セ":["12456"],
	"ソ":["2456"],
	"タ":["135"],
	"チ":["1235"],
	"ツ":["1345"],
	"テ":["12345"],
	"ト":["2345"],
	"ナ":["13"],
	"ニ":["123"],
	"ヌ":["134"],
	"ネ":["1234"],
	"ノ":["234"],
	"ハ":["136"],
	"ヒ":["1236"],
	"フ":["1346"],
	"ヘ":["12346"],
	"ホ":["2346"],
	"マ":["1356"],
	"ミ":["12356"],
	"ム":["13456"],
	"メ":["123456"],
	"モ":["23456"],
	"ヤ":["34"],
	"ユ":["346"],
	"ヨ":["345"],
	"ラ":["15"],
	"リ":["125"],
	"ル":["145"],
	"レ":["1245"],
	"ロ":["245"],
	"ワ":["3"],
	"ヰ":["23"],
	"ヱ":["235"],
	"ヲ":["35"],
	"ン":["356"],
	"ッ":["2"],
	"ー":["25"],
	"ガ":["5","16"],
	"ギ":["5","126"],
	"グ":["5","146"],
	"ゲ":["5","1246"],
	"ゴ":["5","246"],
	"ザ":["5","156"],
	"ジ":["5","1256"],
	"ズ":["5","1456"],
	"ゼ":["5","12456"],
	"ゾ":["5","2456"],
	"ダ":["5","135"],
	"ヂ":["5","1235"],
	"ヅ":["5","1345"],
	"デ":["5","12345"],
	"ド":["5","2345"],
	"バ":["5","136"],
	"ビ":["5","1236"],
	"ブ":["5","1346"],
	"ベ":["5","12346"],
	"ボ":["5","2346"],
	"パ":["6","136"],
	"ピ":["6","1236"],
	"プ":["6","1346"],
	"ペ":["6","12346"],
	"ポ":["6","2346"],
	"キャ":["4","16"],
	"キュ":["4","146"],
	"キョ":["4","246"],
	"シャ":["4","156"],
	"シュ":["4","1456"],
	"ショ":["4","2456"],
	"チャ":["4","135"],
	"チュ":["4","1345"],
	"チョ":["4","2345"],
	"ニャ":["4","13"],
	"ニュ":["4","134"],
	"ニョ":["4","234"],
	"ヒャ":["4","136"],
	"ヒュ":["4","1346"],
	"ヒョ":["4","2346"],
	"ピャ":["46","136"],
	"ピュ":["46","1346"],
	"ピョ":["46","2346"],
	"ギャ":["45","16"],
	"ギュ":["45","146"],
	"ギョ":["45","246"],
	"ジャ":["45","156"],
	"ジュ":["45","1456"],
	"ジョ":["45","2456"],
	"ヂャ":["45","135"],
	"ヂュ":["45","1345"],
	"ヂョ":["45","2345"],
	"ビャ":["45","136"],
	"ビュ":["45","1346"],
	"ビョ":["45","2346"],
	"ミャ":["4","1356"],
	"ミュ":["4","13456"],
	"ミョ":["4","23456"],
	"リャ":["4","15"],
	"リュ":["4","145"],
	"リョ":["4","245"],
	"イェ":["4","124"],
	"シェ":["4","12456"],
	"ジェ":["45","12456"],
	"ティ":["4","1235"],
	"ディ":["45","1235"],
	"ウィ":["26","12"],
	"ウェ":["26","124"],
	"ウォ":["26","24"],
	"トゥ":["26","1345"],
	"ドゥ":["256","1345"],
	"クァ":["26","16"],
	"クィ":["26","126"],
	"クェ":["26","1246"],
	"クォ":["26","246"],
	"グァ":["256","16"],
	"ツァ":["26","135"],
	"ツィ":["26","1235"],
	"ツェ":["26","12345"],
	"ツォ":["26","2345"],
	"テュ":["46","1345"],
	"ファ":["26","136"],
	"フィ":["26","1236"],
	"フェ":["26","12346"],
	"フォ":["26","2346"],
	"フュ":["46","346"],
	"ヴァ":["256","136"],
	"ヴィ":["256","1236"],
	"ヴェ":["256","12346"],
	"ヴォ":["256","2346"],
	"ヴュ":["456","346"],
	"デュ":["456","1345"],
	"ヴ":["5","14"],
	"チェ":["4","12345"]
    };
    return tenji_table[chs];
}

function tokenize(str){
    //カタカナ文字列を点字化する単位に分けたリストに変換
    //促音を除く小文字を前にある文字と一緒に切り出す
    let komoji = /[ァィゥェォャュョ]/;
    var kana_list = [];
    for(let i=0;i<str.length;i++){
	if(str.charAt(i+1).match(komoji)){
	    kana_list.push(str.substr(i,2));
	    i++;
	}else{
	    kana_list.push(str.charAt(i));
	}
    }
    return kana_list;	
}

function amidaize(chs){
    //点字トークンが引数として与えられる
    //123456に南無阿弥陀仏を当てて変換
    return chs.replace(/1/,"南").
	replace(/2/,"無").
	replace(/3/,"阿").
	replace(/4/,"弥").
	replace(/5/,"陀").
	replace(/6/,"仏");
}


function sanitize(str){
    //入力文字列をカタカナ化し、点字化可能かチェック
}


